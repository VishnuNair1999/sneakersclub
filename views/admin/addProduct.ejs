<%- include('../partials/admin-header.ejs') %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.9/cropper.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.9/cropper.min.css" />

<div class="container">
  <div class="screen-overlay"></div>
  <main class="main-wrap mx-auto">
    <section class="content-main">
      <div class="row">
        <div class="col-12">
          <div class="content-header">
            <h2 class="content-title">Add New Product</h2>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="card mb-4">
            <div class="card-body">
              <form class="myForm" id="myForm" method="post" action="/admin/addProduct" enctype="multipart/form-data">
                <div class="row">
                  <div class="col-lg-6 mb-3">
                    <label for="product_name" class="form-label">Name</label>
                    <input type="text" name="name" placeholder="Type here" class="form-control" id="name">
                    <div id="titleError" class="invalid-feedback"></div>
                  </div>
                  <div class="col-lg-6 mb-3">
                    <label for="product_brand" class="form-label">Brand</label>
                    <input type="text" name="brand" placeholder="Type here" class="form-control" id="brand">
                    <div id="brandError" class="invalid-feedback"></div>
                  </div>
                </div>

                <div class="mb-4">
                  <label class="form-label">Description</label>
                  <textarea placeholder="Type here" name="description" id="description" class="form-control" rows="4"></textarea>
                  <div id="descriptionError" class="invalid-feedback"></div>
                </div>
                <div class="row">
                  <div class="col-lg-4">
                    <div class="mb-4">
                      <label class="form-label">Price</label>
                      <div class="row gx-2">
                        <input placeholder="â‚¹" name="price" id="price" type="text" class="form-control">
                        <div id="priceError" class="invalid-feedback"></div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="mb-4">
                      <label class="form-label">Quantity</label>
                      <input name="quantity" id="quantity" type="number" min="1" max="100" required class="form-control">
                      <div id="stockError" class="invalid-feedback"></div>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <label class="form-label">Category</label>
                    <select class="form-select" name="category" id="category">
                      <% categories.forEach(function(item) { %>
                      <option value="<%= item.category %>"> <%= item.category %> </option>
                      <% }); %>
                    </select>
                    <div id="categoryError" class="invalid-feedback"></div>                  </div>
                  


                </div>

            </div>
          </div> <!-- card end// -->
        </div>
        <div class="col-lg-6">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Media</h4>
            </div>
            <div class="input-upload">
              <img src="/imgs/theme/upload.svg" id="imgView1" alt="">
              <input class="form-control" id="input1" name="file" onchange="viewImage1(event)" type="file">
            </div>
            <div class="image-cropper" style="display:none;">
              <img src="" id="croppedImg1" alt="">
              <button type="button" id="saveButton1" class="btn-sm btn-primary">Save</button>
            </div>

          </div> <!-- card end// -->
        </div>
        <div class="col-lg-6">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Media</h4>
            </div>
            <div class="input-upload">
              <img src="/imgs/theme/upload.svg" id="imgView2" alt="">
              <input class="form-control" id="input2" name="file" onchange="viewImage2(event)" type="file">
            </div>
            <div class="image-cropper" style="display:none;">
              <img src="" id="croppedImg2" alt="">
              <button type="button" id="saveButton2" class="btn-sm btn-primary">Save</button>
            </div>

          </div> <!-- card end// -->
        </div>
        <div class="col-lg-6">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Media</h4>
            </div>
            <div class="input-upload">
              <img src="/imgs/theme/upload.svg" id="imgView3" alt="">
              <input class="form-control" id="input3" name="file" onchange="viewImage3(event)" type="file">
            </div>
            <div class="image-cropper" style="display:none;">
              <img src="" id="croppedImg3" alt="">
              <button type="button" id="saveButton3" class="btn-sm btn-primary">Save</button>
            </div>

          </div> <!-- card end// -->
        </div>
        <div class="col-lg-6">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Media</h4>
            </div>
            <div class="input-upload">
              <img src="/imgs/theme/upload.svg" id="imgView4" alt="">
              <input class="form-control" id="input4" name="file" onchange="viewImage4(event)" type="file">
            </div>
            <div class="image-cropper" style="display:none;">
              <img src="" id="croppedImg4" alt="">
              <button type="button" id="saveButton4" class="btn-sm btn-primary">Save</button>
            </div>

          </div> <!-- card end// -->
        </div>
        <!-- <div>
          <button type="button" onclick="validate()" class="btn  btn-primary rounded font-sm mr-5 hover-up">Save</button>
          <a href="/admin"> <button class="btn  btn-danger rounded font-sm hover-up">Cancel</button></a>
        </div> -->
        <div>
          <button type="submit" onclick="return validateForm()"
          class="btn btn-md rounded font-sm hover-up">
          Save
      </button>         
       <a href="/productList"><button class="btn btn-danger rounded font-sm hover-up">Cancel</button></a>
        </div>
      </div>
      </form>
    </section> <!-- content-main end// -->
</div>

<script>
  function viewImage1(event) {
    document.getElementById('imgView1').src = URL.createObjectURL(event.target.files[0])
  }

  function viewImage2(event) {
    document.getElementById('imgView2').src = URL.createObjectURL(event.target.files[0])
  }

  function viewImage3(event) {
    document.getElementById('imgView3').src = URL.createObjectURL(event.target.files[0])
  }

  function viewImage4(event) {
    document.getElementById('imgView4').src = URL.createObjectURL(event.target.files[0])
  }
</script>
<script>
   
  function validateForm() {
    var title = document.getElementById("name").value.trim();
    var brand=document.getElementById("brand")
    var description = document.getElementById("description").value.trim();
    var price = document.getElementById("price").value.trim();
    var stock = document.getElementById("quantity").value.trim();
    var category = document.getElementsByName("category")[0].value;

    var isValid = true;

    // Check if title is not empty
    if (title == "") {
      document.getElementById("title").classList.add("is-invalid");
      document.getElementById("titleError").innerHTML = "Please enter a title.";
      isValid = false;
    } else {
      document.getElementById("title").classList.remove("is-invalid");
      document.getElementById("titleError").innerHTML = "";
    }

    if (brand == "") {
      document.getElementById("brand").classList.add("is-invalid");
      document.getElementById("brandError").innerHTML = "Please enter a title.";
      isValid = false;
    } else {
      document.getElementById("brand").classList.remove("is-invalid");
      document.getElementById("brandError").innerHTML = "";
    }
    // Check if description is not empty
    if (description == "") {
      document.getElementById("description").classList.add("is-invalid");
      document.getElementById("descriptionError").innerHTML = "Please enter a description.";
      isValid = false;
    } else {
      document.getElementById("description").classList.remove("is-invalid");
      document.getElementById("descriptionError").innerHTML = "";
    }

    // Check if price is a valid number
    if (isNaN(price) || price == "" || price < 0) {
      document.getElementById("price").classList.add("is-invalid");
      document.getElementById("priceError").innerHTML = "Please enter a valid price.";
      isValid = false;
    } else {
      document.getElementById("price").classList.remove("is-invalid");
      document.getElementById("priceError").innerHTML = "";
    }

    // Check if stock is a valid number
    if (isNaN(stock) || stock == "" || stock < 0) {
      document.getElementById("stock").classList.add("is-invalid");
      document.getElementById("stockError").innerHTML = "Please enter a valid stock quantity.";
      isValid = false;
    } else {
      document.getElementById("stock").classList.remove("is-invalid");
      document.getElementById("stockError").innerHTML = "";
    }

    // Check if category is selected
    if (category == "") {
      document.getElementsByName("category")[0].classList.add("is-invalid");
      document.getElementById("categoryError").innerHTML = "Please select a category.";
      isValid = false;
    } else {
      document.getElementsByName("category")[0].classList.remove("is-invalid");
      document.getElementById("categoryError").innerHTML = "";
    }

    return isValid;
  }

</script>

<script>


//examine




  function validateImage(fileInput) {
    const allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif|\.avif|\.webp)$/i;
    const maxSize = 5242880; // 5MB
    const fileSize = fileInput.files[0].size;

    if (!allowedExtensions.exec(fileInput.value)) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Please select an image file to upload!',
      })
      fileInput.value = "";
      return false;
    }

    if (fileSize > maxSize) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'File is too large. Please upload an image that is smaller than 5MB.',
      })
      fileInput.value = "";
      return false;
    }

    return true;
  }






  //to find the subcategories

  $(document).ready(function() {
    // When the user selects a category, update the subcategory options
    $('#category').on('change', function() {
      var category = $(this).val();
      $.ajax({
        url: '/admin/getSubcategories',
        type: 'POST',
        data: {
          category: category
        },
        success: function(data) {
          // Clear existing options
          $('#sub_category').empty();
          // Extract subcategory names from data array
          var subcategories = data.map(function(subcategory) {
            return subcategory.name;
          });
          // Add the new options
          if (subcategories.length > 0) {
            for (var i = 0; i < subcategories.length; i++) {
              var subcategory = subcategories[i];
              $('#sub_category').append('<option value="' + subcategory + '">' + subcategory + '</option>');
            }
          } else {
            $('#sub_category').append('<option value="">-- No subcategories found --</option>');
          }
        },

        error: function(jqXHR, textStatus, errorThrown) {
          console.log('AJAX error: ' + textStatus + ' - ' + errorThrown);
        }
      });
    });
  });






</script>

<style>
  p {
    font-size: 12px;
  }
</style>
<%- include('../partials/admin-footer.ejs') %>